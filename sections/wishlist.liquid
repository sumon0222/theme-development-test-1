{% assign wishlist = customer.metafields.custom.wishlist | default: "[]" | parse_json %}

<section class="wishlist-section">
  <h1>Your Wishlist</h1>

  {% if wishlist.size > 0 %}
    <div class="wishlist-items">
      {% for product_id in wishlist %}
        {% assign product = all_products[product_id] %}
        {% if product %}
          <div class="wishlist-item">
            <a href="{{ product.url }}">
              <img src="{{ product.featured_image | image_url }}" alt="{{ product.title }}">
              <h2>{{ product.title }}</h2>
            </a>
            <button class="remove-wishlist" data-product-id="{{ product.id }}">Remove</button>
          </div>
        {% else %}
          <p>Product not found: {{ product_id }}</p>
        {% endif %}
      {% endfor %}
    </div>
  {% else %}
    <p>Your wishlist is empty.</p>
  {% endif %}
</section>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let wishlist = JSON.parse({{ customer.metafields.custom.wishlist | default: "[]" | json }});

    document.querySelectorAll(".remove-wishlist").forEach(button => {
        button.addEventListener("click", function () {
            const productId = this.getAttribute("data-product-id");
            wishlist = wishlist.filter(id => id !== productId);
            localStorage.setItem("wishlist", JSON.stringify(wishlist));
            this.closest(".wishlist-item").remove();
        });
    });
});
</script>
